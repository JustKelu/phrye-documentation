<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="../assets/phyre-icon.png">
    <title>Middleware - Phyre</title>
<meta name="description" content="Learn how to use middleware in Phyre for authentication, logging, and more." />
<link rel="stylesheet" href="../public/index.css">
                </head>
<body>
    <div id="root"><link rel="preload" as="image" href="../assets/phyre-logo.png"/><div class="min-h-screen bg-black text-gray-100"><header class="sticky top-0 z-50 border-b border-gray-900 bg-black/80 backdrop-blur-sm"><div class="container mx-auto px-4 py-4"><div class="flex items-center justify-between"><a class="flex items-center gap-2 group" href="/" data-discover="true"><div class="w-20 h-8 rounded-lg flex items-center justify-center"><img src="../assets/phyre-logo.png"/></div></a><nav class="hidden md:flex items-center gap-6"><a class="text-sm text-gray-400 hover:text-white transition-colors" href="/docs/getting-started.html" data-discover="true">Docs</a><a href="https://github.com/justkelu/phyre" target="_blank" rel="noopener noreferrer" class="text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg>GitHub</a></nav><button class="md:hidden p-2 text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></button></div></div></header><div class="container mx-auto px-4 py-8"><div class="flex flex-col lg:flex-row gap-8"><aside class="w-full lg:w-64 flex-shrink-0"><nav class="sticky top-24 space-y-6"><div><h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3">Getting Started</h3><ul class="space-y-2"><li><a class="block px-3 py-2 rounded-lg text-sm transition-colors text-gray-400 hover:text-white hover:bg-gray-900" href="/docs/getting-started.html" data-discover="true">Introduction</a></li></ul></div><div><h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3">Core Concepts</h3><ul class="space-y-2"><li><a class="block px-3 py-2 rounded-lg text-sm transition-colors text-gray-400 hover:text-white hover:bg-gray-900" href="/docs/routing.html" data-discover="true">Routing</a></li><li><a class="block px-3 py-2 rounded-lg text-sm transition-colors text-gray-400 hover:text-white hover:bg-gray-900" href="/docs/layouts.html" data-discover="true">Layouts</a></li><li><a class="block px-3 py-2 rounded-lg text-sm transition-colors text-gray-400 hover:text-white hover:bg-gray-900" href="/docs/loaders.html" data-discover="true">Data Loading</a></li><li><a class="block px-3 py-2 rounded-lg text-sm transition-colors text-gray-400 hover:text-white hover:bg-gray-900" href="/docs/meta-tags.html" data-discover="true">Meta Tags</a></li><li><a class="block px-3 py-2 rounded-lg text-sm transition-colors text-gray-400 hover:text-white hover:bg-gray-900" href="/docs/error-boundaries.html" data-discover="true">Error Boundaries</a></li></ul></div><div><h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3">API</h3><ul class="space-y-2"><li><a class="block px-3 py-2 rounded-lg text-sm transition-colors text-gray-400 hover:text-white hover:bg-gray-900" href="/docs/api-routes.html" data-discover="true">API Routes</a></li><li><a class="block px-3 py-2 rounded-lg text-sm transition-colors bg-purple-950/50 text-purple-400 font-medium border-l-2 border-purple-500" href="/docs/middleware.html" data-discover="true">Middleware</a></li></ul></div><div><h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3">Package Structure</h3><ul class="space-y-2"><li><a class="block px-3 py-2 rounded-lg text-sm transition-colors text-gray-400 hover:text-white hover:bg-gray-900" href="/docs/package-setup.html" data-discover="true">Package Setup</a></li></ul></div><div><h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3">Reference</h3><ul class="space-y-2"><li><a class="block px-3 py-2 rounded-lg text-sm transition-colors text-gray-400 hover:text-white hover:bg-gray-900" href="/docs/configuration.html" data-discover="true">Configuration</a></li></ul></div></nav></aside><main class="flex-1 min-w-0"><div class="prose max-w-none"><article><h1>Middleware</h1><p class="text-xl text-gray-400 mb-8">Middleware functions have access to <code>req</code>, <code>res</code>, and <code>next</code>. They execute in the order specified.</p><h2>Middleware Structure</h2><div class="relative group my-6 rounded-lg overflow-hidden border border-gray-800 bg-gray-950"><div class="flex items-center justify-between px-4 py-2 bg-gray-900/50 border-b border-gray-800"><span class="text-xs font-mono text-gray-500 uppercase">javascript</span><button class="flex items-center gap-1.5 px-2 py-1 text-xs bg-gray-800 hover:bg-gray-700 text-gray-300 rounded transition-colors"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>Copy</button></div><pre class="p-4 overflow-x-auto text-sm leading-relaxed"><div class="p-4"><code class="font-mono text-gray-300">// Example middleware
export function myMiddleware(req, res, next) {
    // Add data to request
    req.customData = &#x27;value&#x27;;
    
    // Continue to next middleware/handler
    next();
}</code></div></pre></div><h2>File-based API with Middleware</h2><p>Attach middleware to the function using <code>.middleware</code> property:</p><div class="relative group my-6 rounded-lg overflow-hidden border border-gray-800 bg-gray-950"><div class="flex items-center justify-between px-4 py-2 bg-gray-900/50 border-b border-gray-800"><span class="text-xs font-mono text-gray-500 uppercase">javascript</span><button class="flex items-center gap-1.5 px-2 py-1 text-xs bg-gray-800 hover:bg-gray-700 text-gray-300 rounded transition-colors"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>Copy</button></div><pre class="p-4 overflow-x-auto text-sm leading-relaxed"><div class="p-4"><code class="font-mono text-gray-300">// src/server/api/sum.js
import { myMiddle } from &#x27;./middlewares/myMiddle.js&#x27;;
import { myMiddleTwo } from &#x27;./middlewares/myMiddleTwo.js&#x27;;

export function GET(req, res) {
    const result = req.one + req.two;
    res.json({ data: result });
}

// Attach middleware
GET.middleware = [myMiddle, myMiddleTwo];</code></div></pre></div><p class="bg-gray-900 border border-gray-800 rounded-lg p-4 my-4"><strong>Execution order:</strong><br/>1. <code>myMiddle</code> runs first<br/>2. <code>myMiddleTwo</code> runs second<br/>3. <code>GET</code> handler runs last</p><h2>Config-based API with Middleware</h2><p>Add middleware to the route definition:</p><div class="relative group my-6 rounded-lg overflow-hidden border border-gray-800 bg-gray-950"><div class="flex items-center justify-between px-4 py-2 bg-gray-900/50 border-b border-gray-800"><span class="text-xs font-mono text-gray-500 uppercase">javascript</span><button class="flex items-center gap-1.5 px-2 py-1 text-xs bg-gray-800 hover:bg-gray-700 text-gray-300 rounded transition-colors"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>Copy</button></div><pre class="p-4 overflow-x-auto text-sm leading-relaxed"><div class="p-4"><code class="font-mono text-gray-300">// src/server/api/sum.js
import { myMiddle } from &#x27;./middlewares/myMiddle.js&#x27;;
import { myMiddleTwo } from &#x27;./middlewares/myMiddleTwo.js&#x27;;

export const config = {
    routes: [
        {
            path: &#x27;/&#x27;,
            method: &#x27;GET&#x27;,
            handler: sum,
            middleware: [myMiddle, myMiddleTwo]
        }
    ]
};

function sum(req, res) {
const result = req.one + req.two;
res.json({ data: result });
}</code></div></pre></div><h2>Middleware Examples</h2><h3>Authentication</h3><div class="relative group my-6 rounded-lg overflow-hidden border border-gray-800 bg-gray-950"><div class="flex items-center justify-between px-4 py-2 bg-gray-900/50 border-b border-gray-800"><span class="text-xs font-mono text-gray-500 uppercase">javascript</span><button class="flex items-center gap-1.5 px-2 py-1 text-xs bg-gray-800 hover:bg-gray-700 text-gray-300 rounded transition-colors"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>Copy</button></div><pre class="p-4 overflow-x-auto text-sm leading-relaxed"><div class="p-4"><code class="font-mono text-gray-300">// src/server/middlewares/auth.js

export function authMiddleware(req, res, next) {
const token = req.headers.authorization;

if (!token) {
    return res.status(401).json({ error: &#x27;Unauthorized&#x27; });
}

try {
    req.user = verifyToken(token);
    next();
} catch (err) {
    return res.status(401).json({ error: &#x27;Invalid token&#x27; });
}

}

function verifyToken(token) {
// Verify JWT token...
return { id: 1, name: &#x27;User&#x27; };
}</code></div></pre></div><h3>Logging</h3><div class="relative group my-6 rounded-lg overflow-hidden border border-gray-800 bg-gray-950"><div class="flex items-center justify-between px-4 py-2 bg-gray-900/50 border-b border-gray-800"><span class="text-xs font-mono text-gray-500 uppercase">javascript</span><button class="flex items-center gap-1.5 px-2 py-1 text-xs bg-gray-800 hover:bg-gray-700 text-gray-300 rounded transition-colors"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>Copy</button></div><pre class="p-4 overflow-x-auto text-sm leading-relaxed"><div class="p-4"><code class="font-mono text-gray-300">// src/server/middlewares/logger.js

export function logMiddleware(req, res, next) {
console.log(`[${new Date().toISOString()}] ${req.method} ${req.path}`);
next();
}</code></div></pre></div><h3>CORS</h3><div class="relative group my-6 rounded-lg overflow-hidden border border-gray-800 bg-gray-950"><div class="flex items-center justify-between px-4 py-2 bg-gray-900/50 border-b border-gray-800"><span class="text-xs font-mono text-gray-500 uppercase">javascript</span><button class="flex items-center gap-1.5 px-2 py-1 text-xs bg-gray-800 hover:bg-gray-700 text-gray-300 rounded transition-colors"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>Copy</button></div><pre class="p-4 overflow-x-auto text-sm leading-relaxed"><div class="p-4"><code class="font-mono text-gray-300">// src/server/middlewares/cors.js

export function corsMiddleware(req, res, next) {
res.header(&#x27;Access-Control-Allow-Origin&#x27;, &#x27;*&#x27;);
res.header(&#x27;Access-Control-Allow-Methods&#x27;, &#x27;GET,POST,PUT,DELETE&#x27;);
res.header(&#x27;Access-Control-Allow-Headers&#x27;, &#x27;Content-Type,Authorization&#x27;);

if (req.method === &#x27;OPTIONS&#x27;) {
    return res.sendStatus(200);
}

next();

}</code></div></pre></div><h3>Rate Limiting</h3><div class="relative group my-6 rounded-lg overflow-hidden border border-gray-800 bg-gray-950"><div class="flex items-center justify-between px-4 py-2 bg-gray-900/50 border-b border-gray-800"><span class="text-xs font-mono text-gray-500 uppercase">javascript</span><button class="flex items-center gap-1.5 px-2 py-1 text-xs bg-gray-800 hover:bg-gray-700 text-gray-300 rounded transition-colors"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>Copy</button></div><pre class="p-4 overflow-x-auto text-sm leading-relaxed"><div class="p-4"><code class="font-mono text-gray-300">// src/server/middlewares/rateLimit.js

const requests = new Map();

export function rateLimitMiddleware(req, res, next) {
const ip = req.ip;
const now = Date.now();
const windowMs = 60 * 1000; // 1 minute
const maxRequests = 100;

if (!requests.has(ip)) {
    requests.set(ip, []);
}

const userRequests = requests.get(ip);
const recentRequests = userRequests.filter(time =&gt; now - time &lt; windowMs);

if (recentRequests.length &gt;= maxRequests) {
    return res.status(429).json({ error: &#x27;Too many requests&#x27; });
}

recentRequests.push(now);
requests.set(ip, recentRequests);

next();

}</code></div></pre></div><h2>Global Middleware</h2><p>Apply middleware to all routes using <code>src/server/global.js</code>:</p><div class="relative group my-6 rounded-lg overflow-hidden border border-gray-800 bg-gray-950"><div class="flex items-center justify-between px-4 py-2 bg-gray-900/50 border-b border-gray-800"><span class="text-xs font-mono text-gray-500 uppercase">javascript</span><button class="flex items-center gap-1.5 px-2 py-1 text-xs bg-gray-800 hover:bg-gray-700 text-gray-300 rounded transition-colors"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>Copy</button></div><pre class="p-4 overflow-x-auto text-sm leading-relaxed"><div class="p-4"><code class="font-mono text-gray-300">// src/server/global.js

import { corsMiddleware } from &#x27;./middlewares/cors.js&#x27;;
import { logMiddleware } from &#x27;./middlewares/logger.js&#x27;;

export const middlewares = [
    corsMiddleware,
    logMiddleware
];</code></div></pre></div><p class="bg-purple-950/20 border border-purple-900/50 rounded-lg p-4 my-4"><strong>ðŸ’¡ Tip:</strong> Global middlewares in package structure must be placed only in the server folder of the first declared package.<br/>For example:<div class="relative group my-6 rounded-lg overflow-hidden border border-gray-800 bg-gray-950"><div class="flex items-center justify-between px-4 py-2 bg-gray-900/50 border-b border-gray-800"><span class="text-xs font-mono text-gray-500 uppercase">javascript</span><button class="flex items-center gap-1.5 px-2 py-1 text-xs bg-gray-800 hover:bg-gray-700 text-gray-300 rounded transition-colors"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>Copy</button></div><pre class="p-4 overflow-x-auto text-sm leading-relaxed"><div class="p-4"><code class="font-mono text-gray-300">packages: [
    { name: &#x27;web&#x27;, prefix: &#x27;/&#x27; },
    { name: &#x27;admin&#x27;, prefix: &#x27;/admin&#x27; }
]</code></div></pre></div><strong>Global middlewares should be placed in the web package&#x27;s server folder.</strong></p><h2>Error Handling Middleware</h2><p>Create error handlers with 4 parameters:</p><div class="relative group my-6 rounded-lg overflow-hidden border border-gray-800 bg-gray-950"><div class="flex items-center justify-between px-4 py-2 bg-gray-900/50 border-b border-gray-800"><span class="text-xs font-mono text-gray-500 uppercase">javascript</span><button class="flex items-center gap-1.5 px-2 py-1 text-xs bg-gray-800 hover:bg-gray-700 text-gray-300 rounded transition-colors"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>Copy</button></div><pre class="p-4 overflow-x-auto text-sm leading-relaxed"><div class="p-4"><code class="font-mono text-gray-300">// src/server/middlewares/errorHandler.js

export function errorHandler(err, req, res, next) {
console.error(err.stack);

res.status(err.status || 500).json({
    error: process.env.NODE_ENV === &#x27;production&#x27; 
        ? &#x27;Internal server error&#x27;
        : err.message
});

}</code></div></pre></div><div class="flex items-center justify-between mt-12 pt-8 border-t border-gray-800"><a class="flex items-center gap-2 text-purple-400 hover:text-purple-300 font-semibold" href="/docs/api-routes.html" data-discover="true"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18"></path></svg>Previous: API Routes</a><a class="flex items-center gap-2 text-purple-400 hover:text-purple-300 font-semibold" href="/docs/package-setup.html" data-discover="true">Next: Package Setup<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg></a></div></article></div></main><aside class="hidden xl:block w-64 flex-shrink-0"><div class="sticky top-24"><h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3"></h3><div class="text-sm text-gray-500"></div></div></aside></div></div><footer class="border-t border-gray-900 mt-20"><div class="container mx-auto px-4 py-8"><div class="flex flex-col md:flex-row items-center justify-between gap-4"><p class="text-sm text-gray-500">Â© <!-- -->2025<!-- --> Phyre. Built with ðŸ”¥</p><div class="flex items-center gap-4 text-sm text-gray-500"><a href="https://github.com/justkelu/phyre" class="hover:text-purple-400 transition-colors">GitHub</a><a href="https://github.com/justkelu/phyre/issues" class="hover:text-purple-400 transition-colors">Issues</a></div></div></div></footer></div></div>

                
                </body>
</html>